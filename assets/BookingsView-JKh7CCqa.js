import{r as e,s as a,f as t,g as l,o as s,j as n,i as o,h as i,n as r,k as c,D as u,l as d,t as m,F as f,x as v}from"./vendor-fZwiNsBY.js";import{updateData as _,selectData as g}from"./supabase-gyfX3_XW.js";import{_ as p}from"./index-CV7Tce-X.js";import"./ui-framework-B1OpzUlH.js";const k={class:"booking-management"},h={key:1,class:"text-center py-6"},y={key:2,class:"text-center py-6"},b={class:"text-body-2 text-medium-emphasis"},x={key:3},w={class:"text-h6"},B={class:"text-subtitle-1 font-weight-bold"},M={class:"booking-detail"},j={class:"font-weight-medium"},C={class:"booking-detail"},V={class:"booking-detail"},q={class:"booking-detail"},D={class:"booking-detail"},L={class:"booking-detail"},R={key:0,class:"mt-2"},S={class:"text-body-2"},F=p({__name:"BookingManagement",setup(p){const F=e([]),P=e(!0),z=e(null),A=e(""),I=e([]);async function $(){if(A.value.trim()){P.value=!0,z.value=null;try{const e=A.value.toLowerCase().trim(),a=(await g("bookings",{select:"*, rooms_types(name, price_per_night)",filters:{guest_email:e}})).map((e=>{var a,t,l;return{id:e.id,booking_reference:e.reference,room_name:(null==(a=e.rooms_types)?void 0:a.name)||"Room",status:e.status,total_price:e.total_price,check_in_date:e.check_in_date,check_out_date:e.check_out_date,adults:Math.floor(e.guests_count||1),children:e.guests_count?Math.max(0,e.guests_count-Math.floor(e.guests_count)):0,email:e.guest_email,first_name:(null==(t=e.guest_name)?void 0:t.split(" ")[0])||"",last_name:(null==(l=e.guest_name)?void 0:l.split(" ")[1])||"",phone:e.phone||"",special_requests:e.special_requests}}));F.value=a,I.value=[...a]}catch(e){z.value="Failed to load bookings. Please try again.",F.value=[],I.value=[]}finally{P.value=!1}}else z.value="Please enter an email address to search for your bookings"}function E(){$()}function K(e){return new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})}function N(e){switch(e){case"confirmed":return"success";case"pending":return"warning";case"cancelled":return"error";default:return"info"}}return a((()=>{P.value=!1})),(e,a)=>{const g=t("v-text-field"),p=t("v-col"),F=t("v-btn"),T=t("v-row"),U=t("v-card-text"),Y=t("v-card"),G=t("v-alert"),H=t("v-progress-circular"),J=t("v-icon"),O=t("v-chip"),Q=t("v-card-title"),W=t("v-spacer"),X=t("v-card-actions");return s(),l("div",k,[a[7]||(a[7]=n("h2",{class:"text-h5 font-weight-bold mb-6"},"Manage Your Bookings",-1)),o(Y,{class:"mb-6",variant:"outlined"},{default:c((()=>[o(U,null,{default:c((()=>[o(T,{align:"center"},{default:c((()=>[o(p,{cols:"12",sm:"8"},{default:c((()=>[o(g,{modelValue:A.value,"onUpdate:modelValue":a[0]||(a[0]=e=>A.value=e),label:"Enter your email address",variant:"outlined",density:"comfortable","hide-details":"","append-inner-icon":"mdi-magnify",onKeyup:u(E,["enter"])},null,8,["modelValue"])])),_:1}),o(p,{cols:"12",sm:"4",class:"text-center text-sm-end"},{default:c((()=>[o(F,{color:"primary",onClick:E,loading:P.value},{default:c((()=>a[1]||(a[1]=[d(" Search Bookings ")]))),_:1},8,["loading"])])),_:1})])),_:1})])),_:1})])),_:1}),z.value?(s(),i(G,{key:0,type:"error",variant:"tonal",class:"mb-4",closable:""},{default:c((()=>[d(m(z.value),1)])),_:1})):r("",!0),P.value?(s(),l("div",h,[o(H,{indeterminate:"",color:"primary"}),a[2]||(a[2]=n("p",{class:"mt-3"},"Loading bookings...",-1))])):0===I.value.length?(s(),l("div",y,[o(J,{icon:"mdi-calendar-remove",size:"x-large",color:"grey"}),a[3]||(a[3]=n("p",{class:"text-body-1 mt-3"},"No bookings found",-1)),n("p",b,m(A.value?"Try a different email address or check your booking confirmation.":"Make a reservation to see your bookings here."),1)])):(s(),l("div",x,[(s(!0),l(f,null,v(I.value,(e=>(s(),i(Y,{key:e.id,class:"mb-4",variant:"outlined"},{default:c((()=>[o(Q,{class:"d-flex justify-space-between align-center"},{default:c((()=>[n("div",null,[n("span",w,m(e.room_name),1),o(O,{color:N(e.status),size:"small",class:"ml-2",variant:"tonal"},{default:c((()=>[d(m(e.status),1)])),_:2},1032,["color"])]),n("div",B,"$"+m(e.total_price),1)])),_:2},1024),o(U,null,{default:c((()=>[o(T,null,{default:c((()=>[o(p,{cols:"12",md:"6"},{default:c((()=>[n("div",M,[o(J,{icon:"mdi-calendar-range",class:"mr-2"}),n("span",j,m(K(e.check_in_date))+" - "+m(K(e.check_out_date)),1)]),n("div",C,[o(J,{icon:"mdi-account-group",class:"mr-2"}),n("span",null,m(e.adults)+" Adults"+m(e.children>0?`, ${e.children} Children`:""),1)]),n("div",V,[o(J,{icon:"mdi-identifier",class:"mr-2"}),n("span",null,"Booking Reference: "+m(e.booking_reference),1)])])),_:2},1024),o(p,{cols:"12",md:"6"},{default:c((()=>[n("div",q,[o(J,{icon:"mdi-account",class:"mr-2"}),n("span",null,m(e.first_name)+" "+m(e.last_name),1)]),n("div",D,[o(J,{icon:"mdi-email",class:"mr-2"}),n("span",null,m(e.email),1)]),n("div",L,[o(J,{icon:"mdi-phone",class:"mr-2"}),n("span",null,m(e.phone),1)])])),_:2},1024)])),_:2},1024),e.special_requests?(s(),l("div",R,[a[4]||(a[4]=n("div",{class:"text-subtitle-2 font-weight-medium"},"Special Requests:",-1)),n("p",S,m(e.special_requests),1)])):r("",!0)])),_:2},1024),o(X,null,{default:c((()=>[o(W),"confirmed"===e.status?(s(),i(F,{key:0,color:"error",variant:"outlined",onClick:a=>async function(e){if(confirm("Are you sure you want to cancel this booking?"))try{P.value=!0,await _("bookings",{status:"cancelled"},{reference:e}),alert("Booking cancelled successfully!"),$()}catch(a){alert("Failed to cancel booking. Please try again.")}finally{P.value=!1}}(e.booking_reference)},{default:c((()=>a[5]||(a[5]=[d(" Cancel Booking ")]))),_:2},1032,["onClick"])):r("",!0),o(F,{color:"primary",variant:"tonal"},{default:c((()=>a[6]||(a[6]=[d(" View Details ")]))),_:1})])),_:2},1024)])),_:2},1024)))),128))]))])}}},[["__scopeId","data-v-fd3c0974"]]),P=p({__name:"BookingsView",setup:e=>(e,a)=>{const l=t("v-col"),r=t("v-row"),u=t("v-container");return s(),i(u,null,{default:c((()=>[o(r,null,{default:c((()=>[o(l,{cols:"12"},{default:c((()=>a[0]||(a[0]=[n("h1",{class:"text-h3 font-weight-bold mb-6"},"My Bookings",-1),n("p",{class:"text-subtitle-1"},"View and manage your reservations at Shangri La Beach Resort.",-1)]))),_:1})])),_:1}),o(r,null,{default:c((()=>[o(l,{cols:"12"},{default:c((()=>[o(F)])),_:1})])),_:1})])),_:1})}},[["__scopeId","data-v-628b903f"]]);export{P as default};
