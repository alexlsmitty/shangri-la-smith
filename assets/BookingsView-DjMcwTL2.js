import{_ as E,r as y,m as A,a as l,b as v,o as d,f as a,e,d as w,i as b,g as s,z as I,h as k,t as c,F as K,p as T}from"./index-BDwX7PDV.js";import{u as j,s as U}from"./supabase-VVmpH1MK.js";const Y={class:"booking-management"},G={key:1,class:"text-center py-6"},H={key:2,class:"text-center py-6"},J={class:"text-body-2 text-medium-emphasis"},O={key:3},Q={class:"text-h6"},W={class:"text-subtitle-1 font-weight-bold"},X={class:"booking-detail"},Z={class:"font-weight-medium"},ee={class:"booking-detail"},te={class:"booking-detail"},ae={class:"booking-detail"},se={class:"booking-detail"},oe={class:"booking-detail"},ne={key:0,class:"mt-2"},le={class:"text-body-2"},ce={__name:"BookingManagement",setup(S){const B=y([]),i=y(!0),u=y(null),_=y(""),f=y([]);A(()=>{i.value=!1});async function C(){if(!_.value.trim()){u.value="Please enter an email address to search for your bookings";return}i.value=!0,u.value=null;try{const r=_.value.toLowerCase().trim();console.log(`Searching for bookings with email: ${r}`);const t=await U("bookings",{select:"*, rooms_types(name, price_per_night)",filters:{guest_email:r}});console.log("Bookings found:",t);const x=t.map(o=>{var p,g,h;return{id:o.id,booking_reference:o.reference,room_name:((p=o.rooms_types)==null?void 0:p.name)||"Room",status:o.status,total_price:o.total_price,check_in_date:o.check_in_date,check_out_date:o.check_out_date,adults:Math.floor(o.guests_count||1),children:o.guests_count?Math.max(0,o.guests_count-Math.floor(o.guests_count)):0,email:o.guest_email,first_name:((g=o.guest_name)==null?void 0:g.split(" ")[0])||"",last_name:((h=o.guest_name)==null?void 0:h.split(" ")[1])||"",phone:o.phone||"",special_requests:o.special_requests}});B.value=x,f.value=[...x]}catch(r){console.error("Error loading bookings:",r),u.value="Failed to load bookings. Please try again.",B.value=[],f.value=[]}finally{i.value=!1}}function V(){C()}function M(r){const t={year:"numeric",month:"long",day:"numeric"};return new Date(r).toLocaleDateString(void 0,t)}async function $(r){if(confirm("Are you sure you want to cancel this booking?"))try{i.value=!0,console.log(`Cancelling booking with reference: ${r}`);const t=await j("bookings",{status:"cancelled"},{reference:r});console.log("Cancellation result:",t),alert("Booking cancelled successfully!"),C()}catch(t){console.error("Error cancelling booking:",t),alert("Failed to cancel booking. Please try again.")}finally{i.value=!1}}function q(r){switch(r){case"confirmed":return"success";case"pending":return"warning";case"cancelled":return"error";default:return"info"}}return(r,t)=>{const x=l("v-text-field"),o=l("v-col"),p=l("v-btn"),g=l("v-row"),h=l("v-card-text"),D=l("v-card"),L=l("v-alert"),N=l("v-progress-circular"),m=l("v-icon"),F=l("v-chip"),z=l("v-card-title"),P=l("v-spacer"),R=l("v-card-actions");return d(),v("div",Y,[t[7]||(t[7]=a("h2",{class:"text-h5 font-weight-bold mb-6"},"Manage Your Bookings",-1)),e(D,{class:"mb-6",variant:"outlined"},{default:s(()=>[e(h,null,{default:s(()=>[e(g,{align:"center"},{default:s(()=>[e(o,{cols:"12",sm:"8"},{default:s(()=>[e(x,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=n=>_.value=n),label:"Enter your email address",variant:"outlined",density:"comfortable","hide-details":"","append-inner-icon":"mdi-magnify",onKeyup:I(V,["enter"])},null,8,["modelValue"])]),_:1}),e(o,{cols:"12",sm:"4",class:"text-center text-sm-end"},{default:s(()=>[e(p,{color:"primary",onClick:V,loading:i.value},{default:s(()=>t[1]||(t[1]=[k(" Search Bookings ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),u.value?(d(),w(L,{key:0,type:"error",variant:"tonal",class:"mb-4",closable:""},{default:s(()=>[k(c(u.value),1)]),_:1})):b("",!0),i.value?(d(),v("div",G,[e(N,{indeterminate:"",color:"primary"}),t[2]||(t[2]=a("p",{class:"mt-3"},"Loading bookings...",-1))])):f.value.length===0?(d(),v("div",H,[e(m,{icon:"mdi-calendar-remove",size:"x-large",color:"grey"}),t[3]||(t[3]=a("p",{class:"text-body-1 mt-3"},"No bookings found",-1)),a("p",J,c(_.value?"Try a different email address or check your booking confirmation.":"Make a reservation to see your bookings here."),1)])):(d(),v("div",O,[(d(!0),v(K,null,T(f.value,n=>(d(),w(D,{key:n.id,class:"mb-4",variant:"outlined"},{default:s(()=>[e(z,{class:"d-flex justify-space-between align-center"},{default:s(()=>[a("div",null,[a("span",Q,c(n.room_name),1),e(F,{color:q(n.status),size:"small",class:"ml-2",variant:"tonal"},{default:s(()=>[k(c(n.status),1)]),_:2},1032,["color"])]),a("div",W,"$"+c(n.total_price),1)]),_:2},1024),e(h,null,{default:s(()=>[e(g,null,{default:s(()=>[e(o,{cols:"12",md:"6"},{default:s(()=>[a("div",X,[e(m,{icon:"mdi-calendar-range",class:"mr-2"}),a("span",Z,c(M(n.check_in_date))+" - "+c(M(n.check_out_date)),1)]),a("div",ee,[e(m,{icon:"mdi-account-group",class:"mr-2"}),a("span",null,c(n.adults)+" Adults"+c(n.children>0?`, ${n.children} Children`:""),1)]),a("div",te,[e(m,{icon:"mdi-identifier",class:"mr-2"}),a("span",null,"Booking Reference: "+c(n.booking_reference),1)])]),_:2},1024),e(o,{cols:"12",md:"6"},{default:s(()=>[a("div",ae,[e(m,{icon:"mdi-account",class:"mr-2"}),a("span",null,c(n.first_name)+" "+c(n.last_name),1)]),a("div",se,[e(m,{icon:"mdi-email",class:"mr-2"}),a("span",null,c(n.email),1)]),a("div",oe,[e(m,{icon:"mdi-phone",class:"mr-2"}),a("span",null,c(n.phone),1)])]),_:2},1024)]),_:2},1024),n.special_requests?(d(),v("div",ne,[t[4]||(t[4]=a("div",{class:"text-subtitle-2 font-weight-medium"},"Special Requests:",-1)),a("p",le,c(n.special_requests),1)])):b("",!0)]),_:2},1024),e(R,null,{default:s(()=>[e(P),n.status==="confirmed"?(d(),w(p,{key:0,color:"error",variant:"outlined",onClick:de=>$(n.booking_reference)},{default:s(()=>t[5]||(t[5]=[k(" Cancel Booking ")])),_:2},1032,["onClick"])):b("",!0),e(p,{color:"primary",variant:"tonal"},{default:s(()=>t[6]||(t[6]=[k(" View Details ")])),_:1})]),_:2},1024)]),_:2},1024))),128))]))])}}},re=E(ce,[["__scopeId","data-v-fd3c0974"]]),ie={__name:"BookingsView",setup(S){return(B,i)=>{const u=l("v-col"),_=l("v-row"),f=l("v-container");return d(),w(f,null,{default:s(()=>[e(_,null,{default:s(()=>[e(u,{cols:"12"},{default:s(()=>i[0]||(i[0]=[a("h1",{class:"text-h3 font-weight-bold mb-6"},"My Bookings",-1),a("p",{class:"text-subtitle-1"},"View and manage your reservations at Shangri La Beach Resort.",-1)])),_:1})]),_:1}),e(_,null,{default:s(()=>[e(u,{cols:"12"},{default:s(()=>[e(re)]),_:1})]),_:1})]),_:1})}}},me=E(ie,[["__scopeId","data-v-628b903f"]]);export{me as default};
