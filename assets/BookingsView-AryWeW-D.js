import{r as e,s as a,f as l,g as o,o as t,j as n,i as s,h as i,n as r,k as c,D as u,l as d,t as m,F as g,x as f}from"./vendor-CRTejrwt.js";import{updateData as v,selectData as _}from"./supabase-CZM_7RBb.js";import{_ as p}from"./index-D-3aAWvc.js";import"./ui-framework-zg02FQwb.js";const k={class:"booking-management"},h={key:1,class:"text-center py-6"},b={key:2,class:"text-center py-6"},y={class:"text-body-2 text-medium-emphasis"},x={key:3},w={class:"text-h6"},B={class:"text-subtitle-1 font-weight-bold"},C={class:"booking-detail"},M={class:"font-weight-medium"},j={class:"booking-detail"},V={class:"booking-detail"},q={class:"booking-detail"},S={class:"booking-detail"},D={class:"booking-detail"},L={key:0,class:"mt-2"},R={class:"text-body-2"},$=p({__name:"BookingManagement",setup(p){const $=e([]),E=e(!0),F=e(null),P=e(""),z=e([]);async function A(){if(P.value.trim()){E.value=!0,F.value=null;try{const e=P.value.toLowerCase().trim();console.log(`Searching for bookings with email: ${e}`);const a=await _("bookings",{select:"*, rooms_types(name, price_per_night)",filters:{guest_email:e}});console.log("Bookings found:",a);const l=a.map((e=>{var a,l,o;return{id:e.id,booking_reference:e.reference,room_name:(null==(a=e.rooms_types)?void 0:a.name)||"Room",status:e.status,total_price:e.total_price,check_in_date:e.check_in_date,check_out_date:e.check_out_date,adults:Math.floor(e.guests_count||1),children:e.guests_count?Math.max(0,e.guests_count-Math.floor(e.guests_count)):0,email:e.guest_email,first_name:(null==(l=e.guest_name)?void 0:l.split(" ")[0])||"",last_name:(null==(o=e.guest_name)?void 0:o.split(" ")[1])||"",phone:e.phone||"",special_requests:e.special_requests}}));$.value=l,z.value=[...l]}catch(e){console.error("Error loading bookings:",e),F.value="Failed to load bookings. Please try again.",$.value=[],z.value=[]}finally{E.value=!1}}else F.value="Please enter an email address to search for your bookings"}function I(){A()}function K(e){return new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})}function N(e){switch(e){case"confirmed":return"success";case"pending":return"warning";case"cancelled":return"error";default:return"info"}}return a((()=>{E.value=!1})),(e,a)=>{const _=l("v-text-field"),p=l("v-col"),$=l("v-btn"),T=l("v-row"),U=l("v-card-text"),Y=l("v-card"),G=l("v-alert"),H=l("v-progress-circular"),J=l("v-icon"),O=l("v-chip"),Q=l("v-card-title"),W=l("v-spacer"),X=l("v-card-actions");return t(),o("div",k,[a[7]||(a[7]=n("h2",{class:"text-h5 font-weight-bold mb-6"},"Manage Your Bookings",-1)),s(Y,{class:"mb-6",variant:"outlined"},{default:c((()=>[s(U,null,{default:c((()=>[s(T,{align:"center"},{default:c((()=>[s(p,{cols:"12",sm:"8"},{default:c((()=>[s(_,{modelValue:P.value,"onUpdate:modelValue":a[0]||(a[0]=e=>P.value=e),label:"Enter your email address",variant:"outlined",density:"comfortable","hide-details":"","append-inner-icon":"mdi-magnify",onKeyup:u(I,["enter"])},null,8,["modelValue"])])),_:1}),s(p,{cols:"12",sm:"4",class:"text-center text-sm-end"},{default:c((()=>[s($,{color:"primary",onClick:I,loading:E.value},{default:c((()=>a[1]||(a[1]=[d(" Search Bookings ")]))),_:1},8,["loading"])])),_:1})])),_:1})])),_:1})])),_:1}),F.value?(t(),i(G,{key:0,type:"error",variant:"tonal",class:"mb-4",closable:""},{default:c((()=>[d(m(F.value),1)])),_:1})):r("",!0),E.value?(t(),o("div",h,[s(H,{indeterminate:"",color:"primary"}),a[2]||(a[2]=n("p",{class:"mt-3"},"Loading bookings...",-1))])):0===z.value.length?(t(),o("div",b,[s(J,{icon:"mdi-calendar-remove",size:"x-large",color:"grey"}),a[3]||(a[3]=n("p",{class:"text-body-1 mt-3"},"No bookings found",-1)),n("p",y,m(P.value?"Try a different email address or check your booking confirmation.":"Make a reservation to see your bookings here."),1)])):(t(),o("div",x,[(t(!0),o(g,null,f(z.value,(e=>(t(),i(Y,{key:e.id,class:"mb-4",variant:"outlined"},{default:c((()=>[s(Q,{class:"d-flex justify-space-between align-center"},{default:c((()=>[n("div",null,[n("span",w,m(e.room_name),1),s(O,{color:N(e.status),size:"small",class:"ml-2",variant:"tonal"},{default:c((()=>[d(m(e.status),1)])),_:2},1032,["color"])]),n("div",B,"$"+m(e.total_price),1)])),_:2},1024),s(U,null,{default:c((()=>[s(T,null,{default:c((()=>[s(p,{cols:"12",md:"6"},{default:c((()=>[n("div",C,[s(J,{icon:"mdi-calendar-range",class:"mr-2"}),n("span",M,m(K(e.check_in_date))+" - "+m(K(e.check_out_date)),1)]),n("div",j,[s(J,{icon:"mdi-account-group",class:"mr-2"}),n("span",null,m(e.adults)+" Adults"+m(e.children>0?`, ${e.children} Children`:""),1)]),n("div",V,[s(J,{icon:"mdi-identifier",class:"mr-2"}),n("span",null,"Booking Reference: "+m(e.booking_reference),1)])])),_:2},1024),s(p,{cols:"12",md:"6"},{default:c((()=>[n("div",q,[s(J,{icon:"mdi-account",class:"mr-2"}),n("span",null,m(e.first_name)+" "+m(e.last_name),1)]),n("div",S,[s(J,{icon:"mdi-email",class:"mr-2"}),n("span",null,m(e.email),1)]),n("div",D,[s(J,{icon:"mdi-phone",class:"mr-2"}),n("span",null,m(e.phone),1)])])),_:2},1024)])),_:2},1024),e.special_requests?(t(),o("div",L,[a[4]||(a[4]=n("div",{class:"text-subtitle-2 font-weight-medium"},"Special Requests:",-1)),n("p",R,m(e.special_requests),1)])):r("",!0)])),_:2},1024),s(X,null,{default:c((()=>[s(W),"confirmed"===e.status?(t(),i($,{key:0,color:"error",variant:"outlined",onClick:a=>async function(e){if(confirm("Are you sure you want to cancel this booking?"))try{E.value=!0,console.log(`Cancelling booking with reference: ${e}`);const a=await v("bookings",{status:"cancelled"},{reference:e});console.log("Cancellation result:",a),alert("Booking cancelled successfully!"),A()}catch(a){console.error("Error cancelling booking:",a),alert("Failed to cancel booking. Please try again.")}finally{E.value=!1}}(e.booking_reference)},{default:c((()=>a[5]||(a[5]=[d(" Cancel Booking ")]))),_:2},1032,["onClick"])):r("",!0),s($,{color:"primary",variant:"tonal"},{default:c((()=>a[6]||(a[6]=[d(" View Details ")]))),_:1})])),_:2},1024)])),_:2},1024)))),128))]))])}}},[["__scopeId","data-v-fd3c0974"]]),E=p({__name:"BookingsView",setup:e=>(e,a)=>{const o=l("v-col"),r=l("v-row"),u=l("v-container");return t(),i(u,null,{default:c((()=>[s(r,null,{default:c((()=>[s(o,{cols:"12"},{default:c((()=>a[0]||(a[0]=[n("h1",{class:"text-h3 font-weight-bold mb-6"},"My Bookings",-1),n("p",{class:"text-subtitle-1"},"View and manage your reservations at Shangri La Beach Resort.",-1)]))),_:1})])),_:1}),s(r,null,{default:c((()=>[s(o,{cols:"12"},{default:c((()=>[s($)])),_:1})])),_:1})])),_:1})}},[["__scopeId","data-v-628b903f"]]);export{E as default};
